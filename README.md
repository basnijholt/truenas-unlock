<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [TrueNAS ZFS Unlock](#truenas-zfs-unlock)
  - [Install](#install)
  - [Setup](#setup)
  - [Usage](#usage)
  - [CLI](#cli)
  - [Running as a Service](#running-as-a-service)
    - [Linux (systemd)](#linux-systemd)
    - [macOS (launchd)](#macos-launchd)
  - [Development](#development)
  - [Credits](#credits)
  - [License](#license)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# TrueNAS ZFS Unlock

[![PyPI](https://img.shields.io/pypi/v/truenas-zfs-unlock)](https://pypi.org/project/truenas-zfs-unlock/)
[![Python](https://img.shields.io/pypi/pyversions/truenas-zfs-unlock)](https://pypi.org/project/truenas-zfs-unlock/)
[![Tests](https://github.com/basnijholt/truenas-zfs-unlock/actions/workflows/test.yml/badge.svg)](https://github.com/basnijholt/truenas-zfs-unlock/actions/workflows/test.yml)
[![License](https://img.shields.io/github/license/basnijholt/truenas-zfs-unlock)](LICENSE)

Unlock encrypted ZFS datasets on TrueNAS via the API.

## Install

```bash
# With uv (recommended)
uv tool install truenas-zfs-unlock

# With pip
pip install truenas-zfs-unlock
```

## Setup

Create `~/.config/truenas-unlock/config.yaml`:

```yaml
host: 192.168.1.214:443
api_key: ~/.secrets/truenas-api-key  # file path or literal
skip_cert_verify: true

# secrets: auto  # auto (default) | files | inline

datasets:
  tank/syncthing: ~/.secrets/syncthing-key  # reads from file
  tank/photos: my-literal-passphrase        # used as-is (no such file)
```

The `secrets` mode controls how values are interpreted:
- **auto** (default): if file exists, read from it; otherwise use as literal
- **files**: always treat values as file paths
- **inline**: always treat values as literal secrets

## Usage

```bash
# Run once
truenas-zfs-unlock

# Run as daemon (every 10 seconds)
truenas-zfs-unlock --daemon

# Custom interval
truenas-zfs-unlock --daemon --interval 30

# Dry run
truenas-zfs-unlock --dry-run
```

## CLI

```bash
truenas-zfs-unlock --help
```

<!-- CODE:BASH:START -->
<!-- export NO_COLOR=1 -->
<!-- export TERM=dumb -->
<!-- export TERMINAL_WIDTH=90 -->
<!-- echo '```bash' -->
<!-- truenas-zfs-unlock --help -->
<!-- echo '```' -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- ⚠️ This content is auto-generated by `markdown-code-runner`. -->

<!-- OUTPUT:END -->



## Running as a Service

### Linux (systemd)

Install:

```bash
curl -fsSL https://raw.githubusercontent.com/basnijholt/truenas-zfs-unlock/main/scripts/linux/install.sh | bash
```

View logs:

```bash
journalctl --user -u truenas-zfs-unlock -f
```

Uninstall:

```bash
curl -fsSL https://raw.githubusercontent.com/basnijholt/truenas-zfs-unlock/main/scripts/linux/uninstall.sh | bash
```

### macOS (launchd)

Install:

```bash
curl -fsSL https://raw.githubusercontent.com/basnijholt/truenas-zfs-unlock/main/scripts/macos/install.sh | bash
```

View logs:

```bash
tail -f ~/Library/Logs/truenas-zfs-unlock/*.out ~/Library/Logs/truenas-zfs-unlock/*.err
```

Uninstall:

```bash
curl -fsSL https://raw.githubusercontent.com/basnijholt/truenas-zfs-unlock/main/scripts/macos/uninstall.sh | bash
```

## Development

```bash
# Clone and install
git clone https://github.com/basnijholt/truenas-zfs-unlock
cd truenas-zfs-unlock
uv sync --dev

# Run tests
uv run pytest

# Run lints
uv run ruff check .
uv run mypy truenas_zfs_unlock.py
```

## Credits

Inspired by [ThorpeJosh/truenas-zfs-unlock](https://github.com/ThorpeJosh/truenas-zfs-unlock).

## License

MIT
